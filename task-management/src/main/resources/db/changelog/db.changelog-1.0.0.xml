<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

  <!-- Managing both DB that use sequences and db that use auto increment -->
  <property name="autoIncrement" value="true" dbms="mysql,mssql,sybase,db2,hsqldb"/>
  <property name="autoIncrement" value="false" dbms="oracle,postgresql"/>

  <!-- Definition of TASK_PROJECTS table -->
  <changeSet author="tclement@exoplatform.com" id="create-projects-table">
    <createTable tableName="TASK_PROJECTS">
      <column name="PROJECT_ID" type="INTEGER" autoIncrement="${autoIncrement}">
        <constraints nullable="false" primaryKey="true" primaryKeyName="PK_TASK_PROJECTS" unique="true"/>
      </column>
      <column name="NAME" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="CREATOR" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  <changeSet author="tclement@exoplatform.com" id="create-projects-sequence" dbms="oracle,postgresql">
    <createSequence sequenceName="SEQ_TASK_PROJECTS_PROJECT_ID" startValue="1"/>
  </changeSet>

  <!-- Definition of TASK_STATUS table -->
  <changeSet author="tclement@exoplatform.com" id="create-status-table">
    <createTable tableName="TASK_STATUS">
      <column name="STATUS_ID" type="INTEGER" autoIncrement="${autoIncrement}">
        <constraints nullable="false" primaryKey="true" primaryKeyName="PK_TASK_STATUS" unique="true"/>
      </column>
      <column name="NAME" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="RANK" type="INTEGER">
        <constraints nullable="false"/>
      </column>
      <column name="PROJECT" type="INTEGER">
        <constraints foreignKeyName="FK_TASK_STATUS_TASK_PROJECTS_01" references="TASK_PROJECTS(PROJECT_ID)" nullable="false"/>
      </column>
    </createTable>
  </changeSet>
  <changeSet author="tclement@exoplatform.com" id="create-status-sequence" dbms="oracle,postgresql">
    <createSequence sequenceName="SEQ_TASK_STATUS_STATUS_ID" startValue="1"/>
  </changeSet>

  <!-- Definition of TASK_TASKS table -->
  <changeSet author="tclement@exoplatform.com" id="create-tasks-table">
    <createTable tableName="TASK_TASKS">
      <column name="TASK_ID" type="INTEGER" autoIncrement="${autoIncrement}">
        <constraints primaryKey="true" primaryKeyName="PK_TASK_TASKS" nullable="false" unique="true"/>
      </column>
      <column name="TITLE" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="DESCRIPTION" type="VARCHAR(100000)">
        <constraints nullable="true"/>
      </column>
      <column name="CONTEXT" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>
      <column name="ASSIGNEE" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="STATUS" type="INTEGER">
        <constraints foreignKeyName="FK_TASK_TASKS_TASK_STATUS_01" references="TASK_STATUS(STATUS_ID)" nullable="false"/>
      </column>
      <column name="CREATOR" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
      <column name="CREATED_TIME" type="TIMESTAMP">
        <constraints nullable="false"/>
      </column>
      <column name="DURATION" type="INTEGER">
        <constraints nullable="true"/>
      </column>
      <column name="START_DATE" type="DATE">
        <constraints nullable="true"/>
      </column>
      <column name="DUE_DATE" type="DATE">
        <constraints nullable="true"/>
      </column>
    </createTable>
  </changeSet>
  <changeSet author="tclement@exoplatform.com" id="create-task-sequence" dbms="oracle,postgresql">
    <createSequence sequenceName="SEQ_TASK_TASKS_TASK_ID" startValue="1"/>
  </changeSet>

</databaseChangeLog>